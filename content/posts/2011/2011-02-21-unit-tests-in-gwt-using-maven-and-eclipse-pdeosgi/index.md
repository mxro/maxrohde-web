---
title: "Unit Tests in GWT (using Maven and eclipse PDE/OSGi)"
date: "2011-02-21"
categories: 
  - "java"
---

One of the strengths of GWT, from my point of view, is that large portions of the code (eg business logic) can be tested with plain old JUnit tests, without the slightest interference from servers, web browsers and other constraints.

However, certain parts of the code must be tested in a richer context including the compiled java script or client/server communication. Luckily, the [GWTTestCase](http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/junit/client/GWTTestCase.html) provides a powerful tool to automate tests in such rich contexts.

Following a few pointers, of how these GWT unit tests can be setup in an environment using Maven and the eclipse PDE (the tests are not exactly using this technology but should be able to be part of a possible OSGi module).

- Create a new gwt module (gwt.xml) in a dedicated package (eg gwttests) in the src/test/java folder such as the following. Make this unit inherit the modules, you want to test.

<table style="border-collapse:collapse;" border="0"><colgroup><col style="width:638px;"></colgroup><tbody valign="top"><tr><td style="padding-left:7px;padding-right:7px;border-top:solid .5pt;border-left:solid .5pt;border-bottom:solid .5pt;border-right:solid .5pt;"><p><span style="color:teal;font-family:Courier New;font-size:10pt;">&lt;?<span style="color:#3f7f7f;">xml</span> <span style="color:#7f007f;">version<span style="color:black;">=<span style="color:#2a00ff;"><em>"1.0"</em></span> <span style="color:#7f007f;">encoding<span style="color:black;">=<span style="color:#2a00ff;"><em>"UTF-8"</em><span style="color:teal;">?&gt;</span></span></span></span></span></span></span></p><p><span style="color:teal;font-family:Courier New;font-size:10pt;">&lt;<span style="color:#3f7f7f;">module</span> <span style="color:#7f007f;">rename-to<span style="color:black;">=<span style="color:#2a00ff;"><em>'nxservergwttests'</em><span style="color:teal;">&gt;</span></span></span></span></span></p><p><span style="color:black;font-family:Courier New;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3f5fbf;">&lt;!-- Inherit the core Web Toolkit stuff. --&gt;</span></span></p><p><span style="color:black;font-family:Courier New;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:teal;">&lt;<span style="color:#3f7f7f;">inherits</span> <span style="color:#7f007f;">name<span style="color:black;">=<span style="color:#2a00ff;"><em>'com.google.gwt.user.User'</em></span> <span style="color:teal;">/&gt;</span></span></span></span></span></p><p>&nbsp;</p><p><span style="color:black;font-family:Courier New;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3f5fbf;">&lt;!-- Other module inherits --&gt;</span></span></p><p><span style="color:black;font-family:Courier New;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:teal;">&lt;<span style="color:#3f7f7f;">inherits</span> <span style="color:#7f007f;">name<span style="color:black;">=<span style="color:#2a00ff;"><em>'nx.servergwt.client.NxGwtClient'</em><span style="color:teal;">&gt;&lt;/<span style="color:#3f7f7f;">inherits<span style="color:teal;">&gt;</span></span></span></span></span></span></span></span></p><p><span style="color:black;font-family:Courier New;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:teal;">&lt;<span style="color:#3f7f7f;">inherits</span> <span style="color:#7f007f;">name<span style="color:black;">=<span style="color:#2a00ff;"><em>"com.google.gwt.junit.JUnit"</em></span> <span style="color:teal;">/&gt;</span></span></span></span></span></p><p>&nbsp;</p><p><span style="color:black;font-family:Courier New;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3f5fbf;">&lt;!-- Specify the <span style="text-decoration:underline;">app</span> entry point class. --&gt;</span></span></p><p><span style="color:black;font-family:Courier New;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:teal;">&lt;<span style="color:#3f7f7f;">entry-point</span> <span style="color:#7f007f;">class<span style="color:black;">=<span style="color:#2a00ff;"><em>'nx.servergwt.tests.DummyEntryPoint'</em></span> <span style="color:teal;">/&gt;</span></span></span></span></span></p><p>&nbsp;</p><p><span style="color:black;font-family:Courier New;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#3f5fbf;">&lt;!-- Specify the paths for translatable code --&gt;</span></span></p><p><span style="color:black;font-family:Courier New;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:teal;">&lt;<span style="color:#3f7f7f;">source</span> <span style="color:#7f007f;">path<span style="color:black;">=<span style="color:#2a00ff;"><em>''</em></span> <span style="color:teal;">/&gt;</span></span></span></span></span></p><p><span style="font-family:Courier New;font-size:10pt;"><span style="color:black;">&nbsp;&nbsp;&nbsp;&nbsp;</span></span></p><p><span style="color:black;font-family:Courier New;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:teal;">&lt;<span style="color:#3f7f7f;">set-property</span> <span style="color:#7f007f;">name<span style="color:black;">=<span style="color:#2a00ff;"><em>"gwt.suppressNonStaticFinalFieldWarnings"</em></span></span></span></span></span></p><p><span style="font-family:Courier New;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#7f007f;">value<span style="color:black;">=<span style="color:#2a00ff;"><em>"true"</em></span> <span style="color:teal;">/&gt;</span></span></span></span></p><p>&nbsp;</p><p><span style="color:teal;font-family:Courier New;font-size:10pt;">&lt;/<span style="color:#3f7f7f;">module<span style="color:teal;">&gt;</span></span></span></p></td></tr></tbody></table>

- Create a class in that package following the naming pattern: "GwtTest\*.java", let this class extend [com.google.gwt.junit.client.GWTTestCase](http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/junit/client/GWTTestCase.html). Return a module name pointing to your module (gwt.xml file) for gwtModuleName()

<table style="border-collapse:collapse;" border="0"><colgroup><col style="width:638px;"></colgroup><tbody valign="top"><tr><td style="padding-left:7px;padding-right:7px;border-top:solid .5pt;border-left:solid .5pt;border-bottom:solid .5pt;border-right:solid .5pt;"><p><span style="color:#7f0055;font-family:Courier New;font-size:10pt;"><strong>public</strong><span style="color:black;"> <span style="color:#7f0055;"><strong>class</strong><span style="color:black;"> GwtTestClientServerCommunication <span style="color:#7f0055;"><strong>extends</strong><span style="color:black;"> GWTTestCase {</span></span></span></span></span></span></p><p>&nbsp;</p><p><span style="color:black;font-family:Courier New;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#646464;">@Override</span></span></p><p><span style="color:black;font-family:Courier New;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#7f0055;"><strong>public</strong><span style="color:black;"> String getModuleName() {</span></span></span></p><p><span style="color:black;font-family:Courier New;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#7f0055;"><strong>return</strong><span style="color:black;"> <span style="color:#2a00ff;">"nx.servergwt.tests.NxServerGwtTests"<span style="color:black;">;</span></span></span></span></span></p><p><span style="font-family:Courier New;font-size:10pt;"><span style="color:black;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></p><p><span style="font-family:Courier New;font-size:10pt;"><span style="color:black;">&nbsp;&nbsp;&nbsp;&nbsp;</span></span></p><p><span style="color:black;font-family:Courier New;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#7f0055;"><strong>public</strong><span style="color:black;"> <span style="color:#7f0055;"><strong>void</strong><span style="color:black;"> testNetworkOperations() {</span></span></span></span></span></p><p><span style="font-family:Courier New;font-size:10pt;"><span style="color:black;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Network n = Nx.<em>newNetwork</em>();</span></span></p><p><span style="color:black;font-family:Courier New;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String root = <span style="color:#2a00ff;">"root"<span style="color:black;">;</span></span></span></p><p><span style="font-family:Courier New;font-size:10pt;"><span style="color:black;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nx.<em>put</em>().node(root).inNetwork(n);</span></span></p><p><span style="color:black;font-family:Courier New;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nx.<em>append</em>().node(<span style="color:#2a00ff;">"a string"<span style="color:black;">).to(root).inNetwork(n);</span></span></span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;</p><p><span style="color:black;font-family:Courier New;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<em>assertTrue</em>(Nx.<em>check</em>().ifNode(root).hasChild(Nx.<em>instanceOf</em>(String.<span style="color:#7f0055;"><strong>class</strong><span style="color:black;">)).inNetwork(n));</span></span></span></p><p><span style="font-family:Courier New;font-size:10pt;"><span style="color:black;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></p><p><span style="font-family:Courier New;font-size:10pt;"><span style="color:black;">&nbsp;&nbsp;&nbsp;&nbsp;</span></span></p><p><span style="color:black;font-family:Courier New;font-size:10pt;">}</span></p></td></tr></tbody></table>

- Now you should be able to run this test using "mvn gwt:test" (but make sure to check for the pitfalls below).

Some possible pitfalls

**\-No compilation unit found for test-**

The GWT compiler might report that the class of the test case could not be found:

<table style="border-collapse:collapse;" border="0"><colgroup><col style="width:638px;"></colgroup><tbody valign="top"><tr><td style="padding-left:7px;padding-right:7px;border-top:solid .5pt;border-left:solid .5pt;border-bottom:solid .5pt;border-right:solid .5pt;"><p>[INFO] com.google.gwt.junit.JUnitFatalLaunchException: The test class ...' was not found in module ...; no compilation unit for that type was seen</p></td></tr></tbody></table>

In this case, there might be problem with the module (gwt.xml) file you have defined, for instance you forgot to declare "<source path\=_''_ />"

**\-Need to manually open test case in browser-**

When executing gwt:test, the maven gwt plugin (or the gwt compile) might report the following:

<table style="border-collapse:collapse;" border="0"><colgroup><col style="width:638px;"></colgroup><tbody valign="top"><tr><td style="padding-left:7px;padding-right:7px;border-top:solid .5pt;border-left:solid .5pt;border-bottom:solid .5pt;border-right:solid .5pt;"><p>[INFO] Please navigate your browser to this URL:</p><p>[INFO] http://130.216.XX.XX:54530/....JUnit/junit.html?gwt.codesvr=130.216.XX.XX:54526</p></td></tr></tbody></table>

This can be omitted by configuring the maven gwt plugin to utilize htmlunit to lunch a browser. Add the following to the pom.xml:

<table style="border-collapse:collapse;" border="0"><colgroup><col style="width:638px;"></colgroup><tbody valign="top"><tr><td style="padding-left:7px;padding-right:7px;border-top:solid .5pt;border-left:solid .5pt;border-bottom:solid .5pt;border-right:solid .5pt;"><p><span style="color:teal;font-family:Courier New;font-size:10pt;">&lt;<span style="color:#3f7f7f;"><span style="background-color:lightgrey;">plugin</span><span style="color:teal;">&gt;</span></span></span></p><p><span style="color:teal;font-family:Courier New;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span style="color:#3f7f7f;">groupId<span style="color:teal;">&gt;<span style="color:black;">org.codehaus.mojo<span style="color:teal;">&lt;/<span style="color:#3f7f7f;">groupId<span style="color:teal;">&gt;</span></span></span></span></span></span></span></p><p><span style="color:black;font-family:Courier New;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:teal;">&lt;<span style="color:#3f7f7f;">artifactId<span style="color:teal;">&gt;<span style="color:black;"><span style="text-decoration:underline;">gwt</span>-<span style="text-decoration:underline;">maven</span>-<span style="text-decoration:underline;">plugin</span><span style="color:teal;">&lt;/<span style="color:#3f7f7f;">artifactId<span style="color:teal;">&gt;</span></span></span></span></span></span></span></span></p><p><span style="font-family:Courier New;font-size:10pt;">...</span></p><p><span style="color:black;font-family:Courier New;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:teal;">&lt;<span style="color:#3f7f7f;">configuration<span style="color:teal;">&gt;</span></span></span></span></p><p><span style="color:black;font-family:Courier New;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:teal;">&lt;<span style="color:#3f7f7f;">htmlunit<span style="color:teal;">&gt;<span style="color:black;">IE8<span style="color:teal;">&lt;/<span style="color:#3f7f7f;">htmlunit<span style="color:teal;">&gt;</span></span></span></span></span></span></span></span></p><p><span style="color:black;font-family:Courier New;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:teal;">&lt;/<span style="color:#3f7f7f;">configuration<span style="color:teal;">&gt;</span></span></span></span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:teal;font-family:Courier New;font-size:10pt;">&lt;mode&gt;<span style="color:black;">htmlunit<span style="color:teal;">&lt;/mode&gt;</span></span></span></p></td></tr></tbody></table>

Now the tests should run without the need to open a browser manually (see [Gwt Maven Plugin Parameters Mode](http://mojo.codehaus.org/gwt-maven-plugin/test-mojo.html))

**\-Access to junit.framework in eclipse PDE-**

Eclipse PDE might report that: "Access restriction: The method assertTrue(boolean) from the type Assert is not accessible due to restriction on required library"

This can mitigated by adding the following dependency:

<table style="border-collapse:collapse;" border="0"><colgroup><col style="width:638px;"></colgroup><tbody valign="top"><tr><td style="padding-left:7px;padding-right:7px;border-top:solid .5pt;border-left:solid .5pt;border-bottom:solid .5pt;border-right:solid .5pt;"><p><span style="color:teal;font-family:Courier New;font-size:10pt;">&nbsp;&nbsp;&nbsp;&nbsp; &lt;<span style="color:#3f7f7f;"><span style="background-color:lightgrey;">dependency</span><span style="color:teal;">&gt;</span></span></span></p><p><span style="color:black;font-family:Courier New;font-size:10pt;"><span style="color:teal;">&lt;<span style="color:#3f7f7f;">groupId<span style="color:teal;">&gt;<span style="color:black;"><span style="text-decoration:underline;">junit</span><span style="color:teal;">&lt;/<span style="color:#3f7f7f;">groupId<span style="color:teal;">&gt;</span></span></span></span></span></span></span></span></p><p><span style="color:black;font-family:Courier New;font-size:10pt;"><span style="color:teal;">&lt;<span style="color:#3f7f7f;">artifactId<span style="color:teal;">&gt;<span style="color:black;"><span style="text-decoration:underline;">junit</span><span style="color:teal;">&lt;/<span style="color:#3f7f7f;">artifactId<span style="color:teal;">&gt;</span></span></span></span></span></span></span></span></p><p><span style="color:black;font-family:Courier New;font-size:10pt;"><span style="color:teal;">&lt;<span style="color:#3f7f7f;">version<span style="color:teal;">&gt;<span style="color:black;">3.8.2<span style="color:teal;">&lt;/<span style="color:#3f7f7f;">version<span style="color:teal;">&gt;</span></span></span></span></span></span></span></span></p><p><span style="color:black;font-family:Courier New;font-size:10pt;"><span style="color:teal;">&lt;<span style="color:#3f7f7f;">scope<span style="color:teal;">&gt;<span style="color:black;">test<span style="color:teal;">&lt;/<span style="color:#3f7f7f;">scope<span style="color:teal;">&gt;</span></span></span></span></span></span></span></span></p><p><span style="color:black;font-family:Courier New;font-size:10pt;"><span style="color:teal;">&lt;/<span style="color:#3f7f7f;"><span style="background-color:lightgrey;">dependency</span><span style="color:teal;">&gt;</span></span></span></span></p></td></tr></tbody></table>

As well as the following imported package in the configuration of the maven bnd plugin:

<table style="border-collapse:collapse;" border="0"><colgroup><col style="width:638px;"></colgroup><tbody valign="top"><tr><td style="padding-left:7px;padding-right:7px;border-top:solid .5pt;border-left:solid .5pt;border-bottom:solid .5pt;border-right:solid .5pt;"><p><span style="font-family:Courier New;font-size:10pt;"><span style="color:black;">org.junit,</span></span></p><p><span style="font-family:Courier New;font-size:10pt;"><span style="color:black;">com.google.gwt.junit.client,</span></span></p><p><span style="color:black;font-family:Courier New;font-size:10pt;">junit.framework,</span></p></td></tr></tbody></table>

After rebuilding the project with "mvn eclipse:clean clean package eclipse:eclipse -Declipse.pde -Declipse.useProjectReferences=false install" and refreshing the files in eclipse, the access restriction error should disappear.

**\-Calls to server Servlets result in 404 errors-**

Some calls per RPC to Servlets on the server might result in 404 errors. In your original project, the Servlets could just be declared in the web.xml configuration. In order for Servlets to work in the GWT unit test, they must be declared in the gwt module definition (and here it is sensible to define them in the module you want to test rather than the 'test' module).

<table style="border-collapse:collapse;" border="0"><colgroup><col style="width:638px;"></colgroup><tbody valign="top"><tr><td style="padding-left:7px;padding-right:7px;border-top:solid .5pt;border-left:solid .5pt;border-bottom:solid .5pt;border-right:solid .5pt;"><p>&lt;servlet path='/yourservletforrpc' class='com.yourpackage.Servlet'&gt;&lt;/servlet&gt;</p></td></tr></tbody></table>

**Resources**

[Gwt Maven Plugin Parameters Mode](http://mojo.codehaus.org/gwt-maven-plugin/test-mojo.html) (set this to htmlunit)

[Maven Gwt Plugin User Guide: Testing](http://mojo.codehaus.org/gwt-maven-plugin/user-guide/testing.html)

[GWT Developer's Guide: JUnit Testing](http://code.google.com/webtoolkit/doc/latest/DevGuideTesting.html)
